#!/usr/bin/env bash

DYNO_TYPE=${DYNO%%.*}
HEROKU_APP_NAME=${HEROKU_APP_NAME:-${APP_NAME:-$(hostname)}}

if [ -z "$TAILSCALE_HOSTNAME" ]; then
  # Swap the . and _ in the dyno with a - since tailscale doesn't allow for periods.
  TAILSCALE_HOSTNAME="heroku-$HEROKU_APP_NAME-$(echo "$DYNO" | tr '._' '-')"
fi

script_dir="$(dirname "${BASH_SOURCE[0]}")"
. "$script_dir/tailnet"
. "$script_dir/tailscale_daemon"
. "$script_dir/tailscale_latest_release"
. "$script_dir/tailscale_status"

function dyno_type_is() {
  [ "$DYNO_TYPE" = "$1" ]
}

#function log_buildpack_info() {
#  echo "-----> $*"
#}
#
#function log_indent() {
#    sed -e 's/^/       /'
#}

function log_tailscale_error() {
  echo "[tailscale] ERROR:" $*
}

function log_tailscale_info() {
  echo "[tailscale]:" $*
}

function log_tailscale_warn() {
  echo "[tailscale] WARN:" $*
}

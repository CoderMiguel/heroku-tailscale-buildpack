#!/usr/bin/env bash

function latest_release_json() {
   if [ -z "$LATEST_RELEASE_JSON" ]; then
     LATEST_RELEASE_JSON=$(curl -s https://api.github.com/repos/tailscale/tailscale/releases/latest)
   fi
   echo "$LATEST_RELEASE_JSON"
}

function latest_tailscale_version() {
  local version=$(jq -r .tag_name <<< "$(latest_release_json)")
  echo "${version#v}" # remove leading 'v'
}

function detect_tailscale_build_arch() {
  case $(uname -m) in
    x86_64) echo "amd64" ;;
    aarch64) echo "arm64" ;;
    *) echo "unknown" ;;
  esac
}
